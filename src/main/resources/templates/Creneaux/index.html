<!DOCTYPE html>
<html lang="en">
<head th:replace="fragments/head :: head"></head>
<body>
<div th:replace="fragments/header :: header"></div>

<h2 style="text-align: center;">Calendrier</h2>
<div id="calendar"></div>
<script th:inline="javascript">
  const isAdmin = /*[[${utilisateur != null and utilisateur.admin}]]*/ false;
</script>


<script>
  function ouvrirModal(dateStr) {
    document.getElementById("dateInput").value = dateStr;
    document.getElementById("demandeModal").style.display = "block";
  }

  function fermerModal() {
    document.getElementById("demandeModal").style.display = "none";
  }
</script>


<script>
  function ouvrirModal(dateStr, isAdmin) {
    const url = isAdmin ? '/creneaux/formulaire-ajout?date=' : '/creneaux/formulaire-demande?date=';

    fetch(url + dateStr)
            .then(response => response.text())
            .then(html => {
              document.getElementById("contenuModalDemande").innerHTML = html;
              const modal = new bootstrap.Modal(document.getElementById("modalDemande"));
              modal.show();
            });
  }

  function fermerDetails() {
    document.getElementById("detailsModal").style.display = "none";
  }

  document.addEventListener('DOMContentLoaded', function () {
    var calendarEl = document.getElementById('calendar');

    var calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      locale: 'fr',
      events: '/creneaux/api/creneaux-valides',

      dateClick: function(info) {
        ouvrirModal(info.dateStr, isAdmin);
      },

      eventClick: function(info) {
        const id = info.event.id;
        fetch(`/creneaux/details/${id}`)
                .then(response => response.text())
                .then(html => {
                  document.getElementById('contenuModalDetail').innerHTML = html;
                  const modal = new bootstrap.Modal(document.getElementById('modalDetail'));
                  modal.show();
                });
      }
    });

    calendar.render();
  });
</script>



<div class="modal fade" id="modalDetail" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content" id="contenuModalDetail">
      <!-- Le HTML des détails sera injecté ici -->
    </div>
  </div>
</div>

<!-- Modal de demande -->
<div class="modal fade" id="modalDemande" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content" id="contenuModalDemande">
      <!-- Le HTML des détails sera injecté ici -->
    </div>
  </div>
</div>

<!-- Modal d' ajout -->
<div class="modal fade" id="modalAjout" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content" id="contenuModalAjout">
      <!-- Le HTML des détails sera injecté ici -->
    </div>
  </div>
</div>

</body>
</html>