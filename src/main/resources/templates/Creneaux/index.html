<!DOCTYPE html>
<html lang="en">
<head th:replace="fragments/head :: head"></head>
<body>

<!-- Affichage du pseudo et bouton logout -->
<div th:if="${utilisateur != null}">
  Connecté en tant que : <strong th:text="${utilisateur.pseudo}"></strong>
  <form th:action="@{/logout}" method="get" style="display:inline;">
    <button type="submit">Déconnexion</button>
  </form>
</div>

<h2 style="text-align: center;">Créneaux disponibles</h2>
<div id="calendar"></div>
<!-- Modal de demande -->
<div id="demandeModal" style="display:none; position:fixed; top:15%; left:30%; width:40%; background:white; border:1px solid #ccc; padding:20px; z-index:1000;">
  <div style="display: flex; justify-content: space-between; align-items: center;">
    <h3 style="margin: 0;">Demander un créneau</h3>
    <button type="button" onclick="fermerModal()" style="border: none; background: transparent; font-size: 18px; cursor: pointer;">✖</button>
  </div>
  <hr>
  <form method="post" action="/creneaux/demander">
    <input type="hidden" id="dateInput" name="date" />

    <label>Heure de début :</label><br>
    <input type="time" name="heureDebut" required><br><br>

    <label>Heure de fin :</label><br>
    <input type="time" name="heureFin" required><br><br>

    <label>Lieu :</label><br>
    <input type="text" name="lieu" required><br><br>

    <button type="submit">Envoyer la demande</button>
    <button type="button" onclick="fermerModal()">Annuler</button>
  </form>
</div>

<script>
  function ouvrirModal(dateStr) {
    document.getElementById("dateInput").value = dateStr;
    document.getElementById("demandeModal").style.display = "block";
  }

  function fermerModal() {
    document.getElementById("demandeModal").style.display = "none";
  }
</script>


<script>

  document.addEventListener('DOMContentLoaded', function () {
    var calendarEl = document.getElementById('calendar');

    var calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      locale: 'fr',
      events: '/creneaux/api/creneaux-valides',
      dateClick: function(info) {
        ouvrirModal(info.dateStr); // Ouvre la modal
      }
    });

    calendar.render();
  });
</script>


<div th:if="${utilisateur != null and !utilisateur.admin}">
  <a th:href="@{/creneaux/demander}">
    <button>Faire une demande de créneau</button>
  </a>
</div>

<div th:if="${utilisateur != null and utilisateur.admin}">
  <a th:href="@{/creneaux/demandes}">
    <button>Gérer les demandes de créneaux</button>
  </a>
</div>

<div th:if="${utilisateur != null and !utilisateur.admin}">
  <a th:href="@{/creneaux/mes_demandes}">
    <button>Voir mes demandes de créneaux</button>
  </a>
</div>
</body>
</html>