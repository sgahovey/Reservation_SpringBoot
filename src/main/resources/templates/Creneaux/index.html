<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Liste des créneaux</title>
</head>
<body>

<!-- Affichage du pseudo et bouton logout -->
<div th:if="${utilisateur != null}">
  Connecté en tant que : <strong th:text="${utilisateur.pseudo}"></strong>
  <form th:action="@{/logout}" method="get" style="display:inline;">
    <button type="submit">Déconnexion</button>
  </form>
</div>

<h2>Liste des créneaux disponibles</h2>

<table border="1">
  <thead>
  <tr>
    <th>Date</th>
    <th>Heure Début</th>
    <th>Heure Fin</th>
    <th>Lieu</th>
    <th>Statut</th>
    <th>Actions</th>
  </tr>
  </thead>
  <tbody>
  <tr th:each="creneau : ${creneaux}">
    <td th:text="${creneau.date}"></td>
    <td th:text="${creneau.heureDebut}"></td>
    <td th:text="${creneau.heureFin}"></td>
    <td th:text="${creneau.lieu}"></td>
    <td th:text="${creneau.reservePar == null ? 'Disponible' : 'Réservé'}"></td>
    <td>
      <!-- Réserver -->
      <form th:if="${creneau.reservePar == null}" th:action="@{'/creneaux/reserver/' + ${creneau.id}}" method="post">
        <button type="submit">Réserver</button>
      </form>

      <!-- Annuler -->
      <form th:if="${creneau.reservePar != null and utilisateur != null and creneau.reservePar.id == utilisateur.id}"
            th:action="@{'/creneaux/annuler/' + ${creneau.id}}" method="post">
        <button type="submit">Annuler</button>
      </form>
    </td>
  </tr>
  </tbody>
</table>
<div th:if="${utilisateur != null and !utilisateur.admin}">
  <a th:href="@{/creneaux/demander}">
    <button>Faire une demande de créneau</button>
  </a>
</div>

</body>
</html>