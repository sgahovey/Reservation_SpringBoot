<!DOCTYPE html>
<html lang="en">
<head th:replace="fragments/head :: head"></head>
<body>
<div th:replace="fragments/header :: header"></div>
<h2>Liste des utilisateurs</h2>

<button class="btn btn-success mb-3" data-bs-toggle="modal" data-bs-target="#ajoutUtilisateurModal">
    <i class="bi bi-person-plus"></i> Ajouter un utilisateur
</button>

<table border="1">
    <thead>
    <tr>
        <th>
            <a th:href="@{/utilisateurs(sort='id', direction=${sort == 'id' and direction == 'asc' ? 'desc' : 'asc'})}">
                ID <span th:text="${sort == 'id' ? (direction == 'asc' ? '▲' : '▼') : ''}"></span>
            </a>
        </th>
        <th>Nom</th>
        <th>Prénom</th>
        <th>Pseudo</th>
        <th>Email</th>
        <th>
            <a th:href="@{/utilisateurs(sort='admin', direction=${sort == 'admin' and direction == 'asc' ? 'desc' : 'asc'})}">
                Admin <span th:text="${sort == 'admin' ? (direction == 'asc' ? '▲' : '▼') : ''}"></span>
            </a>
        </th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="u : ${utilisateurs}">
        <td th:text="${u.id}"></td>
        <td th:text="${u.nom}"></td>
        <td th:text="${u.prenom}"></td>
        <td th:text="${u.pseudo}"></td>
        <td th:text="${u.email}"></td>
        <td th:text="${u.admin ? 'Oui' : 'Non'}"></td>
        <td>
            <a th:href="@{'/utilisateurs/modifier/' + ${u.id}}">✏️</a>
            <a th:href="@{'/utilisateurs/supprimer/' + ${u.id}}"
               onclick="return confirm('Confirmer la suppression ?')">❌</a>
        </td>
    </tr>
    </tbody>
</table>

<div class="modal fade" id="ajoutUtilisateurModal" tabindex="-1" aria-labelledby="ajoutUtilisateurModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="ajoutUtilisateurModalLabel">Ajouter un utilisateur</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
            </div>
            <div class="modal-body" id="contenuModalAjout">
            </div>
        </div>
    </div>
</div>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const ajoutModal = document.getElementById('ajoutUtilisateurModal');
        ajoutModal.addEventListener('show.bs.modal', function () {
            fetch('/utilisateurs/ajouter')
                .then(response => response.text())
                .then(html => {
                    document.getElementById('contenuModalAjout').innerHTML = html;
                })
                .catch(error => {
                    console.error("Erreur lors du chargement du formulaire :", error);
                });
        });
    });
</script>

</body>
</html>
